# 브라우저 렌더링 과정

프론트엔드 개발자에게 있어 JavaScript, HTML, CSS 그리고 이에 파생되는 다양한 라이브러리 및 프레임워크에 대한 이해가 중요하다. **그러나 이러한 모든 요소들이 최종적으로 제 역할을 하게 되는 곳은 웹브라우저다**. 내가 작성한 코드와 프로그램은 결국 웹브라우저를 통해 사용자와 소통하게 된다.

그런 의미에서 내가 작성한 코드들이 어떻게 웹브라우저에서 해석되고 화면에 보여지는지를 이해하는 것은 매우 중요하다. 평소 이에대한 궁금증이 매우 컸기에 이번 기회에 잠시 짬을 내어 관련 내용을 공부해 보았다. 특히 브라우저가 어떻게 HTML과 CSS를 통해 화면을 구성하는지 그 과정에 대해 간략히 정리해 보았다.

---

### DOM Tree 및 CSSOM 트리 생성

모든 렌더링 과정은 브라우저가 네트워크로부터 렌더링에 사용될 항목, 즉 HTML과 CSS를 받아오는 것으로부터 시작된다. 

네트워트를 통해 수신받은 HTML과 CSS는 `바이트` 형태로 구성되어 있기 때문에 이를 변환해 최종 렌더링에 사용될 트리구조로 변환해야 한다. 그 전체적인 프로세스는 다음과 같다.

![full-process-rendering](/img/full-process-rendering.png)( [출처](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=ko))

위의 이미지는 HTML의 바이트형태 데이터를 트리구조 형태로 변환하는 과정이다. 먼저 바이트 형태의 문서를 해당 문서내에 정의된 인코딩 방식에 따라 문자로 변환한다. 이후, 해당 문자열을 미리 지정된 고유 토큰으로 변환하고 해당 토큰의 특징에 부합하는 규칙이 정의되어 있는 노드 객체를 생성한다. 그리고 이러한 노드객체를 부모, 자식관계의 흐름대로 연결하여 트리구조 형태로 최종 변환한다. 

 이렇게 생성된 트리를 `DOM 트리`라고 부른다. CSS 역시 이와 동일한 과정을 거쳐 트리형태로 변환되며 이를 `CSSOM(CSS Object Model)`이라고 칭한다. `CSSOM`은 cascasde(상속)으로 구현하기 위해서 트리구조로 되어있다. 이렇게 생성된 `DOM 트리`와 `CSSOM`트리를 활용해 본격적으로 렌더링에 사용될 `렌더링 트리`를 형성하게 된다. 


 ### Rendering 트리 형성

 위에 생성된 `Dom 트리`와 `CSSOM 트리는` 각각 독립적인 객체이다. 그리고 이 독립적인 객체가 하나로 합쳐졌을 때 비로소 화면에 픽셀을 렌더링할 수 있는 준비가 완료된다.  

![rendering-tree](/img/render-tree-construction.png)([출처](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=ko)) 


1. 라우저는 먼저 DOM 트리의 루트에서부터 각각의 노드를 탐색한다. 이 과정에서 화면에 실제로 표시되지 않는 스트립트, 메타 태그, Head 등은 제외한다.
2. 각각 노드를 탐색하는 시점에서 `CSSOM` 트리를 통해 적절한 스타일을 적용한다. 이 과정에서 `display : none` 으로 적용되어있는 HTML노드는 렌더링 트리에서 제외된다. 
3. 모든 노드에 대한 탐색과 CSS 적용이 마무리되면 `rendering 트리`를 반환한다. 이제 화면을 구성할 준비는 끝났다.


### 레이아웃 및 페인팅

rendering 트리가 완성되었으면 마지막으로 화면에 해당 트리를 활용해 화면을 구성하는 단계가 남았다. 화면을 구성하는 단계로는 `레이아웃 단계`와 `페인팅 단계`가 있다.

`레이아웃 단계`에서는 *View포트 내의 (0, 0)에서 부터 시작하여 각 노드들의 최 상위 엘리먼트부터 정확한 위치와 크기를 캡쳐하는 Box Model을 출력한다*. CSS에 정의된 모든 상대적 위치 및 크기는 모두 절대적인 px로 변환된다. 즉 좌표를 계산하는 과정이다. 브라우저는 Box모델로 구성되어 있기 때문에 박스의 크기와 위치만 계산하면 레이아웃 단계는 끝나게 된다. 

이런 단계를 통해 각각의 노드들의 크기와 위치, 그리고 스타일 등 기하학적 형태가 모두 파악되고 난 후에 화면의 실제 픽셀로 변환하는 작업이 진행된다. 이를 `페인팅` 혹은 `레스터화`라고 부른다. 즉 레이아웃 단계를 통해 반환된 Box Model을 활용해 화면을 구성하는 것이 페인팅 단계이며 해당 단계가 마무리되면 브라우저의 렌더링 작업은 종료된다.

--- 

여기까지가 대략적인 브라우저의 화면 렌더링 과정이다. 대충 브라우저의 렌더링 프로세스를 이해하긴 했지만, 이제 어떻게 해야 이러한 과정을 최적화 할 수 있는지에 대해 공부해야 할 단계가 남았다. 해당 내용은 추후 공부하게 될 때 다시 정리하는 것으로 하자. 
